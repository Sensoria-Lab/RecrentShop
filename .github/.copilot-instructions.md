# RecrentShop - AI Coding Agent Instructions

E-commerce platform for gaming mousepads and apparel. Modern React 18 + TypeScript stack with emphasis on performance, mobile UX, and animation.

## Architecture Overview

### Feature-Based Structure
```
src/
├── features/        # Feature modules (products/)
│   └── products/
│       ├── animations/  # Framer Motion variants
│       ├── components/  # Feature-specific components
│       ├── hooks/       # Feature hooks
│       ├── model/       # Business logic
│       └── types/       # Feature types
├── shared/          # Shared utilities & UI
│   ├── components/  # Global components (Header, Footer, Modal, etc.)
│   ├── hooks/       # useDeviceDetection, useIntersectionObserver
│   ├── lib/         # Utilities (cn, getPublicUrl, shadcn-ui/)
│   ├── ui/          # shadcn/ui components
│   └── utils/       # haptic.ts (mobile vibration feedback)
├── core/            # App core
│   ├── api/         # API client (supports both static & backend)
│   ├── constants/   # config.ts, routes.ts, selectorOptions.ts
│   ├── context/     # CartContext, ToastContext
│   ├── data/        # products.ts (BASE_URL-aware), reviews.ts
│   └── routing/     # React Router v6 config with basename
└── pages/           # Page components (MainPage, CatalogPage, ProductPage, etc.)
backend/             # Express + MySQL API (optional - static fallback exists)
```

**Key insight**: This is a *dual-mode* app—uses static `src/core/data/products.ts` in production, but can switch to MySQL backend via `API_CONFIG.USE_STATIC_DATA` flag.

## Critical Patterns

### 1. GitHub Pages Deployment (basename handling)
```typescript
// src/core/routing/routes.tsx
basename: '/RecrentShop' // Required for GitHub Pages

// src/shared/lib/utils.ts - Image path helper
const BASE_URL = process.env.PUBLIC_URL || ''; // '/RecrentShop' in prod
export const getPublicUrl = (path: string): string => {
  const cleanPath = path.startsWith('/') ? path.slice(1) : path;
  const publicUrl = process.env.PUBLIC_URL || '';
  return !publicUrl || publicUrl === '/' ? `/${cleanPath}` : `${publicUrl}/${cleanPath}`;
};
```
**Always use `BASE_URL` prefix for images in products.ts**. Never hardcode absolute paths.

### 2. Cart System (localStorage + Context)
```typescript
// src/core/context/CartContext.tsx
// - Always adds NEW item on addItem() (no quantity increment)
// - Persists to localStorage automatically via useEffect
// - Provides isCartOpen toggle for CartSidebar
// Key exports: addItem, removeItem, updateQuantity, clearCart, getTotalItems, getTotalPrice
```
**Pattern**: Cart items are unique by variant (id + selectedSize + selectedColor). Don't merge duplicates—add separately.

### 3. Animation System (Framer Motion v12)
```typescript
// src/features/products/animations/productCard.animations.ts
// GPU-accelerated: only transform & opacity
// Spring physics with presets: SPRING_CONFIG.soft|medium|snappy|bouncy
// Variants: cardVariants, imageVariants, badgeVariants, gridStaggerConfig
```
**Performance rule**: Animate only `transform`, `opacity`, `scale`. Avoid layout shifts. Use `motion.div` from `motion` package (not `framer-motion`).

### 4. Mobile-First UX
```typescript
// src/shared/hooks/useDeviceDetection.ts
// Returns: { isMobile, isTablet, isDesktop, isTouchDevice, width, height }

// src/shared/utils/haptic.ts
// Vibration feedback for mobile: triggerHaptic('light'|'medium'|'heavy'|'success'|'error')
```
**Pattern**: Use `useDeviceDetection()` for responsive logic. Add haptic feedback to buttons/interactions on mobile.

### 5. shadcn/ui Integration
```json
// components.json
"aliases": {
  "components": "src/shared/ui",
  "utils": "src/lib/utils" // Note: actual path is src/shared/lib/shadcn-ui/lib/utils.ts
}
```
**Two `cn` functions exist**:
- `src/shared/lib/utils.ts` - Main app utility (filters falsy values)
- `src/shared/lib/shadcn-ui/lib/utils.ts` - Minimal shadcn version

Import from `shared/lib/utils.ts` for app code.

### 6. Page Layout Pattern
```typescript
// All pages use PageContainer wrapper
<PageContainer showBreadcrumbs={true} isMainPage={false}>
  {/* Header auto-hides/shows on scroll (absolute positioned) */}
  {/* Content */}
  {/* Footer */}
</PageContainer>
// BottomNavigation rendered globally in App.tsx (mobile-only)
```

## Development Workflows

### Local Development
```bash
npm start              # Dev server @ localhost:3000
npm run type-check     # TypeScript validation
npm run lint           # ESLint check
```

### Deployment
```bash
npm run build          # Creates optimized build/
npm run deploy         # Publishes to gh-pages branch
```
**Note**: `predeploy` script runs build automatically.

### Backend (Optional)
```bash
cd backend
npm install
npm run init-db        # Creates MySQL tables + admin user
npm run dev            # Nodemon @ localhost:5000
```
Switch to backend mode by setting `REACT_APP_API_URL` env variable.

## TypeScript Conventions

### Product Types
```typescript
// src/features/products/types/product.ts
interface Product {
  id: number;
  category: 'mousepads' | 'clothing';
  clothingType?: 'hoodie' | 'tshirt' | 'sleeve';
  collection?: string;     // For filtering (Geoid, Logo Red, etc.)
  priceNumeric: number;    // For sorting
  price: string;           // Display format "3 000 ₽"
  productSize?: string;    // XL, L (pads) or XS-2XL (clothing)
  images?: string[];       // Gallery images
  // ... rating, reviewCount, addedDate, etc.
}
```

### Filter Types Pattern
```typescript
export type SortOption = 'popularity' | 'price-asc' | 'price-desc' | 'rating';
export type ColorFilter = ('black' | 'white' | 'red')[];
export type SizeFilterValue = 'L-pad' | 'XL-pad' | 'XS-cloth' | 'S-cloth' | ... ;
```

## Code Style Rules

### React Components
- **Functional components only** with hooks
- Export as default: `export default ComponentName;`
- Props interface above component: `interface ComponentProps { ... }`
- Use `React.FC<Props>` for type annotation
- Memoize callbacks with `useCallback` for child components
- Memoize expensive computations with `useMemo`

### Styling
- **Tailwind classes only** (no inline styles)
- Use `cn()` utility for conditional classes: `cn('base', isActive && 'active')`
- Follow shadcn/ui design tokens (see `tailwind.config.js` custom animations)
- Dark theme support via Tailwind's `dark:` variant

### File Naming
- Components: `PascalCase.tsx`
- Utilities: `camelCase.ts`
- Types: `camelCase.ts` or `index.ts` for exports
- Hooks: `useCamelCase.ts`

## Common Gotchas

1. **Image paths**: Must use `${BASE_URL}/images/...` format in products.ts
2. **Router basename**: Set to `/RecrentShop` - affects all navigation
3. **Cart uniqueness**: Same product with different size/color = separate cart item
4. **Animation performance**: Avoid animating `width`, `height`, `padding` - use `scale` instead
5. **TypeScript strict mode**: Enabled - handle undefined/null explicitly

## Testing Checklist

When modifying code, verify:
- [ ] Image paths work in both dev (/) and prod (/RecrentShop)
- [ ] Cart persists to localStorage and survives page refresh
- [ ] Animations run at 60fps (check transform/opacity only)
- [ ] Mobile: haptic feedback works, navigation is accessible
- [ ] TypeScript compiles without errors (`npm run type-check`)
- [ ] Responsive: test mobile (<768px), tablet (768-1024px), desktop (1024px+)

## Key Files Reference

**Must-read for context**:
- `src/core/data/products.ts` - All product data structure
- `src/core/context/CartContext.tsx` - Cart state management
- `src/features/products/animations/productCard.animations.ts` - Animation system
- `src/shared/lib/utils.ts` - Utility functions
- `.github/instructions/reactjs.instructions.md` - React best practices

**Entry points**:
- `src/index.tsx` → `src/core/routing/routes.tsx` → `src/App.tsx` → Page components

---

**See also**: `.github/instructions/reactjs.instructions.md` for React-specific standards (performance, hooks, forms, testing)</content>
<parameter name="filePath">c:\Users\Nikita\Desktop\PROJECTS\rshop\rrshop\.copilot-instructions.md